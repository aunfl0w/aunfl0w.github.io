<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Aun&#39;s Blog  | zpool reimport</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link rel="stylesheet" href="https://aunfl0w.github.io/css/blog.css" />
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-125094479-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>
<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://aunfl0w.github.io">Home</a>
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(https://aunfl0w.github.io/img/bg-blog.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        zpool reimport
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                <h1 id="import-zfs-pool-into-a-new-computer">Import ZFS pool into a new computer</h1>
<p>In this example hardware has failed and the zpool disks are connected to a new computer.  Need to reconstruct the zpool filesystem for continued data use.  All disks from the zpool are now connected to a new computer.</p>
<h2 id="find-the-pool">Find the pool</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@nas:~# zpool import
   pool: zfsdata
     id: <span style="color:#ae81ff">466262796876421602</span>
  state: ONLINE
 status: The pool was last accessed by another system.
 action: The pool can be imported using its name or numeric identifier and
	the <span style="color:#e6db74">&#39;-f&#39;</span> flag.
   see: http://zfsonlinux.org/msg/ZFS-8000-EY
 config:

	zfsdata     ONLINE
	  raidz1-0  ONLINE
	    sdb2    ONLINE
	    sdc2    ONLINE
	    sdd2    ONLINE
	    sde2    ONLINE</code></pre></div>
<h2 id="import-the-pool">Import the pool</h2>
<p>In this case I have a zpool from BSD that is being imported to a Linux system</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@nas:~# zpool import zfsdata
cannot import <span style="color:#e6db74">&#39;zfsdata&#39;</span>: pool was previously in use from another system.
Last accessed by  <span style="color:#f92672">(</span>hostid<span style="color:#f92672">=</span>83b027b5<span style="color:#f92672">)</span> at Wed Jun <span style="color:#ae81ff">23</span> 14:04:59 <span style="color:#ae81ff">2021</span>
The pool can be imported, use <span style="color:#e6db74">&#39;zpool import -f&#39;</span> to import the pool.
root@nas:~# zpool import -f zfsdata
root@nas:~# df -h /zfsdata
Filesystem      Size  Used Avail Use% Mounted on
zfsdata         5.3T  2.7T  2.7T  50% /zfsdata</code></pre></div>
<h2 id="upgrade">Upgrade</h2>
<p>In this case the pool can be upgraded to support new features.  Once upgraded the pool will no longer work on the old system.  In this scenario the old computer is non functional so going back is not an option.  Start an update and the scrub new pool to verify integrity.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@nas:/zfsdata# zpool upgrade zfsdata
This system supports ZFS pool feature flags.

Successfully upgraded <span style="color:#e6db74">&#39;zfsdata&#39;</span> from version <span style="color:#ae81ff">28</span> to feature flags.
Enabled the following features on <span style="color:#e6db74">&#39;zfsdata&#39;</span>:
  async_destroy
  empty_bpobj
  lz4_compress
  multi_vdev_crash_dump
  spacemap_histogram
  enabled_txg
  hole_birth
  extensible_dataset
â€¦

root@nas:/zfsdata# zpool scrub zfsdata
root@nas:/zfsdata# zpool status -v 
  pool: zfsdata
 state: ONLINE
  scan: scrub in progress since Sat Sep  <span style="color:#ae81ff">4</span> 18:08:30 <span style="color:#ae81ff">2021</span>
	155G scanned at 344M/s, 84.1G issued at 187M/s, 3.49T total
	0B repaired, 2.35% <span style="color:#66d9ef">done</span>, <span style="color:#ae81ff">0</span> days 05:19:17 to go
config:

	NAME        STATE     READ WRITE CKSUM
	zfsdata     ONLINE       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
	  raidz1-0  ONLINE       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
	    sdb2    ONLINE       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
	    sdc2    ONLINE       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
	    sdd2    ONLINE       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
	    sde2    ONLINE       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span></code></pre></div>
<h2 id="verify-drive-smart-info">Verify drive smart info</h2>
<p>Instal smartmontools or package with smartctl for your distro.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">for</span> drive in <span style="color:#f92672">{</span>b..e<span style="color:#f92672">}</span>
<span style="color:#66d9ef">do</span> 
	smartctl -i /dev/sd$drive
<span style="color:#66d9ef">done</span>

Adjust smartctl command and review output based on your specific device.</code></pre></div>

            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/family">family</a></span>
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/fpw">fpw</a></span>
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/functional">functional</a></span>
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/linux">linux</a></span>
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/observability">observability</a></span>
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/programming">programming</a></span>
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/security">security</a></span>
        
            <span class="tag"><a href="https://aunfl0w.github.io/tags/x">x</a></span>
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Recent posts</h1>
        
            <h1><a href="https://aunfl0w.github.io/2021/preload-fix/">Alter system calls with LD_PRELOAD</a></h1>
            <time class="has-text-grey-light is-size-7">17 October 2021</time>
        
            <h1><a href="https://aunfl0w.github.io/2021/mount-block-image/">Mount a block device image</a></h1>
            <time class="has-text-grey-light is-size-7">16 October 2021</time>
        
            <h1><a href="https://aunfl0w.github.io/2021/devops/">DevOps notes</a></h1>
            <time class="has-text-grey-light is-size-7">6 September 2021</time>
        
            <h1><a href="https://aunfl0w.github.io/2021/lkm/">Linux kernel module basics</a></h1>
            <time class="has-text-grey-light is-size-7">19 August 2021</time>
        
            <h1><a href="https://aunfl0w.github.io/2021/zpool-reimport/">zpool reimport</a></h1>
            <time class="has-text-grey-light is-size-7">30 July 2021</time>
        
    </div>
</div>
    <br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="https://aunfl0w.github.io/archives/2021">2021</a> (5)<br>
        
            <a href="https://aunfl0w.github.io/archives/2019">2019</a> (2)<br>
        
            <a href="https://aunfl0w.github.io/archives/2018">2018</a> (7)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://twitter.com/aunwick" class="mysocial"><i class="fab fa-twitter fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://github.com/aunfl0w" class="mysocial"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; Aun&#39;s Blog 2021 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
            - <a class="mysocial" href="https://aunfl0w.github.io/about">About</a>
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</body>
</html>
